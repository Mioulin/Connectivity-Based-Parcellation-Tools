

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execution &mdash; cbptools 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Input Validation" href="input_validation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> cbptools
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
</ul>
<p class="caption"><span class="caption-text">Configuration File</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration/instructions.html">Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/input_data.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/parameters.html">Parameters</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_data_structure.html">Input Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_validation.html">Input Validation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Execution</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cbptools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Execution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/execution.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="execution">
<h1>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h1>
<p>Once the project has been successfully created, change the directory to the project directory (<cite>workdir</cite>). This is the
directory the <cite>Snakefile</cite> is located in. From there, a snakemake command can be used in the terminal to start
processing the data.</p>
<p>For a simple local run using 8 threads and at most 20GB of memory, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>snakemake -j <span class="m">8</span> --resources <span class="nv">mem_mb</span><span class="o">=</span><span class="m">20000</span>
</pre></div>
</div>
<p>To execute the pipeline on a cluster using SLURM, make sure to first modify the cluster.json file so that all SLURM
parameters are set properly.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>snakemake -j <span class="m">999</span> -w <span class="m">240</span> -u cluster.json --resources -c <span class="s2">&quot;sbatch -p {cluster.partition} -n {cluster.n} -N {cluster.N} -t {cluster.time} -c {cluster.c} --mem-per-cpu={cluster.mem} --out={cluster.out} --job-name={cluster.name}&quot;</span>
</pre></div>
</div>
<p>Here, <cite>-c “sbatch …”</cite> defines the command snakemake uses to start jobs through SLURM’s sbatch. The <cite>-w 240</cite> is added
to ensure that snakemake waits at least 240 seconds for files to appear on the file system. File system latency may
cause snakemake to assume something went wrong with generating the file.</p>
<p>File system latency may cause issues with particularly large input files. For instance, the <cite>connectivity</cite> task uses
time-series images as input, which can easily be as large as 5 GB. When all parallel job executions of this task
try to simultaneously load such big files, the jobs will slow one another down. For this purpose, the <cite>io</cite> resource has
been added to the ‘rsfmri’ and ‘dmri’ connectivity and probtrackx2 tasks. Simply add <cite>io=x</cite> to the <cite>–resources</cite>
parameter, where x is the number of simultaneous jobs you think your file system can manage. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>snakemake -j <span class="m">999</span> -w <span class="m">240</span> -u cluster.json --resources <span class="nv">io</span><span class="o">=</span><span class="m">10</span> -c <span class="s2">&quot;sbatch -p {cluster.partition} -n {cluster.n} -N {cluster.N} -t {cluster.time} -c {cluster.c} --mem-per-cpu={cluster.mem} --out={cluster.out} --job-name={cluster.name}&quot;</span>
</pre></div>
</div>
<p>Note that the timing of each task depends crucially on the current state of the cluster system and is therefore
difficult to predict. If you notice that jobs fail due to timeouts, the <cite>time</cite> parameter in <cite>cluster.json</cite> should be
increased.</p>
<p>The snakemake tool is very flexible and for more information on how to use it, read the
<a class="reference external" href="https://snakemake.readthedocs.io/en/stable/index.html">snakemake documentation</a>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="input_validation.html" class="btn btn-neutral float-left" title="Input Validation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Niels Reuter

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>